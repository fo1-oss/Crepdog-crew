# ðŸš€ Railway Deployment Guide

## Quick Deploy to Railway

Railway detected! Here's how to deploy your CDC Investor Portal backend:

### 1. Prerequisites

- Railway account (sign up at https://railway.app)
- GitHub repository with your code
- PostgreSQL and Redis addons

### 2. Deploy Backend

**Option A: Deploy from GitHub**

1. Go to https://railway.app/new
2. Click "Deploy from GitHub repo"
3. Select your CDC repository
4. Railway will auto-detect the backend

**Option B: Deploy with Railway CLI**

```bash
# Install Railway CLI
npm i -g @railway/cli

# Login
railway login

# Initialize project
cd backend
railway init

# Deploy
railway up
```

### 3. Add Database Services

In Railway dashboard:

1. **Add PostgreSQL**:
   - Click "New" â†’ "Database" â†’ "PostgreSQL"
   - Railway will auto-create `DATABASE_URL` variable

2. **Add Redis** (Optional but recommended):
   - Click "New" â†’ "Database" â†’ "Redis"
   - Railway will auto-create `REDIS_URL` variable
   - Redis URL: `redis://redis.railway.internal:6379`

### 4. Configure Environment Variables

In Railway dashboard â†’ Variables, add:

```env
# Automatically provided by Railway:
DATABASE_URL=<auto-generated>
REDIS_URL=redis://redis.railway.internal:6379

# You need to add:
NODE_ENV=production
JWT_SECRET=<generate-secure-random-string>
CORS_ORIGIN=https://cdcdataroom.vercel.app

# Google Cloud (if using OCR)
GOOGLE_CLOUD_PROJECT_ID=cdc-investor-portal
GOOGLE_CLOUD_API_KEY=AIzaSyBv4Tr4EZkuMz2ONRu0Y9z5L2RIYgf4jkc
GOOGLE_DRIVE_PITCH_DECK_FOLDER_ID=16dEnuE4Aml9asy6tmn3a8AqtRUn08PTE
GOOGLE_DRIVE_MIS_FOLDER_ID=1hJVr0xzckP_iSMZekXmkAGm_IaGmyHNU
GOOGLE_DRIVE_FINANCIALS_FOLDER_ID=138WYK9a_5kOLRkVCSllR8fD-peJ8JvrG

# Optional
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### 5. Run Database Migrations

In Railway dashboard â†’ Deployments â†’ Click on your service:

```bash
# Add a custom start command in Railway settings:
npm run db:migrate && npm start
```

Or run migrations manually:
```bash
railway run npm run db:migrate
```

### 6. Deploy Frontend to Vercel

Update frontend environment variable in Vercel:

```env
VITE_API_URL=https://your-backend.up.railway.app/api
```

Get your Railway backend URL from the Railway dashboard.

### 7. Update CORS

Once you have your Railway URL, update the backend environment variable:

```env
CORS_ORIGIN=https://cdcdataroom.vercel.app
```

## Railway Configuration Files

### railway.json (already created)

```json
{
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "npm run db:migrate && npm start",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### Nixpacks Configuration

Railway uses Nixpacks to auto-detect Node.js. No additional config needed!

## Redis Integration (Optional)

Redis is configured for:
- Session caching (faster authentication)
- Rate limiting
- Geolocation cache

The backend will work without Redis, but it's recommended for production.

## Monitoring

Railway provides:
- **Logs**: View real-time logs in dashboard
- **Metrics**: CPU, memory, network usage
- **Deployments**: Track all deployments

## Troubleshooting

### Database Connection Issues

```bash
# Check if DATABASE_URL is set
railway variables

# Test database connection
railway run npm run db:studio
```

### Migration Errors

```bash
# Reset database (WARNING: deletes all data)
railway run npm run db:migrate -- --reset

# Or run migrations manually
railway run npx prisma migrate deploy
```

### CORS Errors

Make sure `CORS_ORIGIN` matches your Vercel frontend URL exactly:
```env
CORS_ORIGIN=https://cdcdataroom.vercel.app
```

## Cost Estimate

Railway pricing (as of 2026):
- **Hobby Plan**: $5/month
  - PostgreSQL: Included
  - Redis: Included
  - 500 hours/month execution time

## Complete Deployment Checklist

- [ ] Push code to GitHub
- [ ] Create Railway project
- [ ] Add PostgreSQL database
- [ ] Add Redis database (optional)
- [ ] Set environment variables
- [ ] Run database migrations
- [ ] Deploy backend
- [ ] Get Railway URL
- [ ] Update Vercel frontend with Railway URL
- [ ] Test authentication flow
- [ ] Test analytics tracking
- [ ] (Optional) Test OCR processing

---

**Your backend will be live at**: `https://your-project.up.railway.app` ðŸš€
